---
title: "Distribution Reporting Summary"
output: html_document
---



```{r, echo=FALSE, message=FALSE}
source("password.R") ## loads a variable called password
library(RCurl)
library(stringr)
upass = str_c("mcnepal:", password)
dataCSVstr = getURI("http://ona.io/api/v1/data/52600.csv", userpwd=upass, httpauth = 1L)
distributions = read.csv(textConnection(dataCSVstr), na.strings="n/a")
dataCSVstr1 = getURI("http://ona.io/api/v1/data/52597.csv", userpwd=upass, httpauth = 1L)
benis = read.csv(textConnection(dataCSVstr1), na.strings="n/a")
```

```{r, echo=FALSE, message=FALSE}
vdc_codes = read.csv("vdc_code_list.csv")

distributions = merge(distributions, vdc_codes, by.x="distribution_information.vdc_name", by.y="VDC", all.x=TRUE, all.y=FALSE)
distributions$VDC = distributions$distribution_information.vdc_name

library(dplyr)
dist_by_ward = distributions %>% 
    select(contains("received"))
distributions$TotalFromOna = rowSums(dist_by_ward, na.rm=T)

distribution_summary = distributions %>% 
    group_by(District, VDC) %>%
    summarize(Planned = mean(ToBeDistributed, na.rm=T),
              Distributed = sum(TotalFromOna, na.rm=T)) %>%
    arrange(District, VDC)


capFirst <- function(s) {
    paste(toupper(substring(s, 1, 1)), substring(s, 2), sep = "")
}
distribution_district_aggregate = distribution_summary %>%
    group_by(District) %>% 
    summarize(Distributed = sum(Distributed, na.rm=T))
benis_summary = benis %>% 
    group_by(district_name) %>% 
    summarize(Registered = n())
benis_summary$district_name = capFirst(benis_summary$district_name)
benis_summary = merge(benis_summary, distribution_district_aggregate,  by.y = "District", by.x = "district_name", all = TRUE)
benis_summary = rename (benis_summary , District = district_name)
```

###Distribution Summary
```{r, echo=FALSE, message=FALSE}
knitr::kable(distribution_summary)
```

###Beneficiary Registration and Distribution Summary
```{r, echo=FALSE, message=FALSE}
knitr::kable(benis_summary)
```

**Distributed** column is drawn from the [Distribution Reporting Form](https://beta.ona.io/mcnepal/4384/52600), from `r nrow(distributions)` records.

**Registered** column is drawn from the [Beneficiary Photo Registration Form](https://beta.ona.io/mcnepal/4384/52597), from `r nrow(benis)` records.

Report Generated on `r date()`. 